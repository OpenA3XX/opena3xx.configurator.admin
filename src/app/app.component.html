<div [class.electron-app]="isElectronValue">

  <div *ngIf="!apiAvailabilityStatus" class="api-status">
    <p>
      <mat-icon>error</mat-icon>
      Cannot communicate with OpenA3XX Peripheral API.
    </p>
  </div>
  <mat-toolbar class="opena3xx-toolbar" color="primary">
    <button (click)="toggle()" mat-icon-button>
      <mat-icon *ngIf="isExpandedValue">menu_open</mat-icon>
      <mat-icon *ngIf="!isExpandedValue">menu</mat-icon>
    </button>
    <div
      class="windows-draggable"
      style="position: absolute; left: 50px; width: 80%; height: 50px"
    ></div>

    <h1 class="opena3xx-app-name">OpenA3XX Flight Deck</h1>
    <span class="spacer"></span>
    <button
      (click)="clickNotifications()"
      mat-icon-button
      [matBadge]="unreadNotificationCountValue > 0 ? unreadNotificationCountValue.toString() : null"
      matBadgeColor="accent"
      matBadgeSize="small"
      matTooltip="Notifications"
    >
      <mat-icon>notification_important</mat-icon>
    </button>
    <button
      (click)="fullscreen()"
      mat-icon-button
      matBadgeColor="accent"
      matTooltip="Toggle Fullscreen"
    >
      <mat-icon *ngIf="!isFullscreen">settings_overscan</mat-icon>
      <mat-icon *ngIf="isFullscreen">close_fullscreen</mat-icon>
    </button>
    <button
      (click)="toggleTheme()"
      mat-icon-button
      matTooltip="Toggle Theme"
    >
      <mat-icon *ngIf="isDarkModeValue">light_mode</mat-icon>
      <mat-icon *ngIf="!isDarkModeValue">dark_mode</mat-icon>
    </button>
    <button (click)="toggleRight()" mat-icon-button>
      <mat-icon *ngIf="isRightMenuExpandedValue">menu</mat-icon>
      <mat-icon *ngIf="!isRightMenuExpandedValue">menu_open</mat-icon>
    </button>
    <button (click)="exit()" *ngIf="isElectronValue" mat-icon-button>
      <mat-icon>close</mat-icon>
    </button>
  </mat-toolbar>

  <mat-sidenav-container autosize class="opena3xx-container" [class.with-api-status]="!apiAvailabilityStatus">
    <!-- Left Sidenav -->
    <mat-sidenav #sidenav class="opena3xx-sidenav" [class.collapsed]="!isExpandedValue" [class.expanded]="isExpandedValue" mode="side" [opened]="true">
      <img
        class="opena3xx-logo"
        (click)="clickDashboard()"
        (keydown.enter)="clickDashboard()"
        (keydown.space)="clickDashboard()"
        tabindex="0"
        *ngIf="isExpandedValue"
        alt="OpenA3XX Flight Deck - Go to Dashboard"
        [src]="getLogoPath()"
        style="margin: 18px 10px 10px 63px"
        width="100px"
        role="button"
        aria-label="Navigate to dashboard"/>
      <mat-nav-list>
        <mat-list-item
          (click)="apiAvailabilityStatus ? clickDashboard() : null"
          [matTooltipDisabled]="isExpandedValue"
          class="parent"
          [class.disabled]="!apiAvailabilityStatus"
          [class.collapsed-item]="!isExpandedValue"
          [matTooltip]="!apiAvailabilityStatus ? 'API not available - Navigation disabled' : 'Home'"
          matTooltipPosition="right"
        >
          <mat-icon>home</mat-icon>
          <span *ngIf="isExpandedValue" class="full-width">Home</span>
        </mat-list-item>
        <mat-list-item
          (click)="apiAvailabilityStatus ? clickManageAircraftModels() : null"
          [matTooltipDisabled]="isExpandedValue"
          class="parent"
          [class.disabled]="!apiAvailabilityStatus"
          [class.collapsed-item]="!isExpandedValue"
          [matTooltip]="!apiAvailabilityStatus ? 'API not available - Navigation disabled' : 'Aircraft Models'"
          matTooltipPosition="right"
        >
          <mat-icon>airplanemode_active</mat-icon>
          <span *ngIf="isExpandedValue" class="full-width">Aircraft Models</span>
        </mat-list-item>
        <mat-list-item
          (click)="apiAvailabilityStatus ? clickManageHardwarePanels() : null"
          [matTooltipDisabled]="isExpandedValue"
          class="parent"
          [class.disabled]="!apiAvailabilityStatus"
          [class.collapsed-item]="!isExpandedValue"
          [matTooltip]="!apiAvailabilityStatus ? 'API not available - Navigation disabled' : 'Hardware Panels'"
          matTooltipPosition="right"
        >
          <mat-icon>dashboard</mat-icon>
          <span *ngIf="isExpandedValue" class="full-width">Hardware Panels</span>
        </mat-list-item>
        <mat-list-item
          (click)="apiAvailabilityStatus ? clickManageHardwareInputTypes() : null"
          [matTooltipDisabled]="isExpandedValue"
          class="parent"
          [class.disabled]="!apiAvailabilityStatus"
          [class.collapsed-item]="!isExpandedValue"
          [matTooltip]="!apiAvailabilityStatus ? 'API not available - Navigation disabled' : 'Hardware Input Types'"
          matTooltipPosition="right"
        >
          <mat-icon>login</mat-icon>
          <span *ngIf="isExpandedValue" class="full-width">Hardware Input Types</span>
        </mat-list-item>
        <mat-list-item
          (click)="apiAvailabilityStatus ? clickManageHardwareOutputTypes() : null"
          [matTooltipDisabled]="isExpandedValue"
          class="parent"
          [class.disabled]="!apiAvailabilityStatus"
          [class.collapsed-item]="!isExpandedValue"
          [matTooltip]="!apiAvailabilityStatus ? 'API not available - Navigation disabled' : 'Hardware Output Types'"
          matTooltipPosition="right"
        >
          <mat-icon>logout</mat-icon>
          <span *ngIf="isExpandedValue" class="full-width">Hardware Output Types</span>
        </mat-list-item>
        <mat-list-item
          (click)="apiAvailabilityStatus ? clickManageHardwareBoards() : null"
          [matTooltipDisabled]="isExpandedValue"
          class="parent"
          [class.disabled]="!apiAvailabilityStatus"
          [class.collapsed-item]="!isExpandedValue"
          [matTooltip]="!apiAvailabilityStatus ? 'API not available - Navigation disabled' : 'Hardware Boards'"
          matTooltipPosition="right"
        >
          <mat-icon>developer_board</mat-icon>
          <span *ngIf="isExpandedValue" class="full-width">Hardware Boards</span>
        </mat-list-item>
        <mat-list-item
          (click)="apiAvailabilityStatus ? clickManageSimulatorEvents() : null"
          [matTooltipDisabled]="isExpandedValue"
          class="parent"
          [class.disabled]="!apiAvailabilityStatus"
          [class.collapsed-item]="!isExpandedValue"
          [matTooltip]="!apiAvailabilityStatus ? 'API not available - Navigation disabled' : 'Simulator Events'"
          matTooltipPosition="right"
        >
          <mat-icon>laptop</mat-icon>
          <span *ngIf="isExpandedValue" class="full-width">Simulator Events</span>
        </mat-list-item>
        <mat-list-item
          (click)="apiAvailabilityStatus ? clickConnectivity() : null"
          [matTooltipDisabled]="isExpandedValue"
          class="parent"
          [class.disabled]="!apiAvailabilityStatus"
          [class.collapsed-item]="!isExpandedValue"
          [matTooltip]="!apiAvailabilityStatus ? 'API not available - Navigation disabled' : 'Connectivity'"
          matTooltipPosition="right"
        >
          <mat-icon>wifi</mat-icon>
          <span *ngIf="isExpandedValue" class="full-width">Connectivity</span>
        </mat-list-item>

        <mat-list-item
          (click)="apiAvailabilityStatus ? clickConsole() : null"
          [matTooltipDisabled]="isExpandedValue"
          class="parent"
          [class.disabled]="!apiAvailabilityStatus"
          [class.collapsed-item]="!isExpandedValue"
          [matTooltip]="!apiAvailabilityStatus ? 'API not available - Navigation disabled' : 'Observability Console'"
          matTooltipPosition="right"
        >
          <mat-icon>terminal</mat-icon>
          <span *ngIf="isExpandedValue" class="full-width">Observability Console</span>
        </mat-list-item>

        <mat-list-item
          (click)="apiAvailabilityStatus ? clickNotifications() : null"
          [matTooltipDisabled]="isExpandedValue"
          class="parent"
          [class.disabled]="!apiAvailabilityStatus"
          [class.collapsed-item]="!isExpandedValue"
          [matTooltip]="!apiAvailabilityStatus ? 'API not available - Navigation disabled' : 'Notifications'"
          matTooltipPosition="after"
        >
          <mat-icon
            [matBadge]="unreadNotificationCountValue > 0 ? unreadNotificationCountValue.toString() : null"
            matBadgeColor="accent"
            matBadgePosition="before"
            matBadgeSize="small"
          >notification_important</mat-icon
          >
          <span *ngIf="isExpandedValue" class="full-width">Notification Centre</span>

        </mat-list-item>
        <mat-list-item
          (click)="apiAvailabilityStatus ? clickSettings() : null"
          [matTooltipDisabled]="isExpandedValue"
          class="parent"
          [class.disabled]="!apiAvailabilityStatus"
          [class.collapsed-item]="!isExpandedValue"
          [matTooltip]="!apiAvailabilityStatus ? 'API not available - Navigation disabled' : 'System Settings'"
          matTooltipPosition="right"
        >
          <mat-icon>settings</mat-icon>
          <span *ngIf="isExpandedValue" class="full-width">System Settings</span>
        </mat-list-item>
        <mat-list-item
          (click)="exit()"
          *ngIf="isElectronValue"
          [matTooltipDisabled]="isExpandedValue"
          class="parent"
          [class.collapsed-item]="!isExpandedValue"
          matTooltip="Exit"
          matTooltipPosition="right"
        >
          <mat-icon>exit_to_app</mat-icon>
          <span *ngIf="isExpandedValue" class="full-width">Quit App</span>
        </mat-list-item>
      </mat-nav-list>
    </mat-sidenav>

    <mat-sidenav-content class="opena3xx-sidenav-content">
      <router-outlet></router-outlet>
    </mat-sidenav-content>

    <!-- Right Sidenav -->
    <mat-sidenav class="opena3xx-sidenav-right" [class.collapsed]="!isRightMenuExpandedValue" [class.expanded]="isRightMenuExpandedValue" mode="side" position="end" [opened]="isRightMenuExpandedValue">
      <mat-nav-list>
        <mat-list-item *ngIf="isRightMenuExpandedValue || isRightMenuShowingValue" class="parent system-status-header">

          <mat-icon
            matListItemIcon
            *ngIf="dependencyStatus"
            [class]="dependencyStatus.overall === 'healthy' ? 'ok' : dependencyStatus.overall === 'degraded' ? 'warning' : 'error'"
            [matTooltip]="'Overall Status: ' + (dependencyStatus.overall | titlecase)"
            matTooltipPosition="left">
            {{ dependencyStatus.overall === 'healthy' ? 'check_circle' :
               dependencyStatus.overall === 'degraded' ? 'warning' : 'error' }}
          </mat-icon>
          <span class="full-width system-status-title">System Status</span>
        </mat-list-item>

                        <!-- Backend API Status -->
        <mat-list-item
          class="parent dependency-status-item"
          [matTooltip]="getBackendApiTooltip()"
          matTooltipPosition="left">

          <mat-icon
            matListItemIcon
            [class]="getStatusClass(apiAvailabilityStatus ? 'online' : 'offline')"
            class="dependency-icon api-icon">
            hub
          </mat-icon>
          <span *ngIf="isRightMenuExpandedValue || isRightMenuShowingValue" class="full-width dependency-name">
            OpenA3XX Coordinator
          </span>
        </mat-list-item>

        <!-- MSFS2024 Status -->
        <mat-list-item
          class="parent dependency-status-item"
          [matTooltip]="getDependencyTooltip(dependencyStatusValue?.dependencies?.msfs)"
          matTooltipPosition="left">

          <mat-icon
            matListItemIcon
            [class]="getStatusClass(dependencyStatusValue?.dependencies?.msfs?.status || 'unknown')"
            class="dependency-icon msfs-icon">
            {{ getStatusIcon(dependencyStatusValue?.dependencies?.msfs?.name || 'MSFS2024') }}
          </mat-icon>
          <span *ngIf="isRightMenuExpandedValue || isRightMenuShowingValue" class="full-width dependency-name">
            {{ dependencyStatusValue?.dependencies?.msfs?.name || 'MSFS2024' }}
          </span>
        </mat-list-item>

        <!-- RabbitMQ Status -->
        <mat-list-item
          class="parent dependency-status-item"
          [matTooltip]="getDependencyTooltip(dependencyStatusValue?.dependencies?.rabbitmq)"
          matTooltipPosition="left">

          <mat-icon
            matListItemIcon
            [class]="getStatusClass(dependencyStatusValue?.dependencies?.rabbitmq?.status || 'unknown')"
            class="dependency-icon rabbitmq-icon">
            {{ getStatusIcon(dependencyStatusValue?.dependencies?.rabbitmq?.name || 'RabbitMQ') }}
          </mat-icon>
          <span *ngIf="isRightMenuExpandedValue || isRightMenuShowingValue" class="full-width dependency-name">
            {{ dependencyStatusValue?.dependencies?.rabbitmq?.name || 'RabbitMQ' }}
          </span>
        </mat-list-item>

        <!-- SEQ Status -->
        <mat-list-item
          class="parent dependency-status-item"
          [matTooltip]="getDependencyTooltip(dependencyStatusValue?.dependencies?.seq)"
          matTooltipPosition="left">

          <mat-icon
            matListItemIcon
            [class]="getStatusClass(dependencyStatusValue?.dependencies?.seq?.status || 'unknown')"
            class="dependency-icon seq-icon">
            {{ getStatusIcon(dependencyStatusValue?.dependencies?.seq?.name || 'SEQ') }}
          </mat-icon>
          <span *ngIf="isRightMenuExpandedValue || isRightMenuShowingValue" class="full-width dependency-name">
            {{ dependencyStatusValue?.dependencies?.seq?.name || 'SEQ' }}
          </span>
        </mat-list-item>

                <!-- Status Update Timestamp -->
        <mat-list-item
          *ngIf="(isRightMenuExpandedValue || isRightMenuShowingValue) && dependencyStatus"
          class="parent status-timestamp">
          <span class="full-width timestamp-text">
            Last updated: {{ getFormattedTimestamp(dependencyStatus.timestamp) }}
          </span>
        </mat-list-item>
      </mat-nav-list>
    </mat-sidenav>
  </mat-sidenav-container>

  <!-- Floating Back Button -->
  <opena3xx-floating-back-button></opena3xx-floating-back-button>
</div>
